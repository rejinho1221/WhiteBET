<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - White BET</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/admin.css">
    
    <!-- Script do Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <i class="fas fa-user-shield"></i>
            <span class="admin-name" id="admin-name">Administrador</span>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-section="fighters">
                <i class="fas fa-user-friends"></i>
                <span>Lutadores</span>
            </a>
            <a href="#" class="nav-item" data-section="fights">
                <i class="fas fa-calendar-alt"></i>
                <span>Lutas</span>
            </a>
            <a href="#" class="nav-item logout" id="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Sair</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <button class="menu-toggle" id="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 id="page-title">Dashboard</h1>
            </div>
            <div class="header-right">
                <div class="admin-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="admin-username">Admin</span>
                </div>
            </div>
        </header>

        <!-- Dashboard Section -->
        <section class="admin-section active" id="dashboard-section">
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon bg-primary">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-fighters">0</h3>
                        <p>Total de Lutadores</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-success">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-fights">0</h3>
                        <p>Total de Lutas</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-warning">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="upcoming-fights">0</h3>
                        <p>Próximas Lutas</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-danger">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-bets">R$ 0,00</h3>
                        <p>Valor Total Apostado</p>
                    </div>
                </div>
            </div>

            <div class="recent-activity">
                <h2><i class="fas fa-history"></i> Atividades Recentes</h2>
                <div class="activity-list" id="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon bg-info">
                            <i class="fas fa-plus"></i>
                        </div>
                        <div class="activity-content">
                            <p>Bem-vindo ao painel administrativo!</p>
                            <small>Hoje</small>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Fighters Section -->
        <section class="admin-section" id="fighters-section">
            <div class="section-header">
                <h2><i class="fas fa-user-friends"></i> Gerenciar Lutadores</h2>
                <button class="btn btn-primary" id="new-fighter-btn">
                    <i class="fas fa-plus"></i> Novo Lutador
                </button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Apelido</th>
                            <th>Data de Nascimento</th>
                            <th>Equipe</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="fighters-table-body">
                        <tr>
                            <td colspan="6" class="loading-data">
                                <div class="spinner"></div>
                                Carregando lutadores...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Fights Section -->
        <section class="admin-section" id="fights-section">
            <div class="section-header">
                <h2><i class="fas fa-calendar-alt"></i> Gerenciar Lutas</h2>
                <button class="btn btn-primary" id="new-fight-btn">
                    <i class="fas fa-plus"></i> Nova Luta
                </button>
            </div>

            <div class="search-filter">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="fight-search" placeholder="Buscar luta...">
                </div>
                <div class="filter-box">
                    <select id="status-filter">
                        <option value="">Todos os status</option>
                        <option value="scheduled">Agendadas</option>
                        <option value="completed">Finalizadas</option>
                        <option value="cancelled">Canceladas</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Local</th>
                            <th>Lutadores</th>
                            <th>Valor Apostado</th>
                            <th>Odd</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody id="fights-table-body">
                        <tr>
                            <td colspan="7" class="loading-data">
                                <div class="spinner"></div>
                                Carregando lutas...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Modal para Novo Lutador -->
    <div class="modal" id="fighter-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="fighter-modal-title">Novo Lutador</h2>
            <form id="fighter-form">
                <input type="hidden" id="fighter-id">
                <div class="form-row">
                    <div class="form-group">
                        <label for="fighter-name">Nome Completo *</label>
                        <input type="text" id="fighter-name" class="form-control" required placeholder="Nome do lutador">
                    </div>
                    <div class="form-group">
                        <label for="fighter-nickname">Apelido</label>
                        <input type="text" id="fighter-nickname" class="form-control" placeholder="Apelido do lutador">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="fighter-birthdate">Data de Nascimento</label>
                        <input type="date" id="fighter-birthdate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="fighter-team">Equipe</label>
                        <input type="text" id="fighter-team" class="form-control" placeholder="Nome da equipe">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="cancel-fighter-btn">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Salvar Lutador
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Nova Luta -->
    <div class="modal" id="fight-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="fight-modal-title">Nova Luta</h2>
            <form id="fight-form">
                <input type="hidden" id="fight-id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="fighter1-select">Lutador 1 *</label>
                        <select id="fighter1-select" class="form-control" required>
                            <option value="">Selecione um lutador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fighter2-select">Lutador 2 *</label>
                        <select id="fighter2-select" class="form-control" required>
                            <option value="">Selecione um lutador</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="fight-date">Data e Hora *</label>
                        <input type="datetime-local" id="fight-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="fight-location">Local *</label>
                        <input type="text" id="fight-location" class="form-control" placeholder="Academia, Cidade - Estado" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bet-amount-1">Valor Apostado em Lutador 1 *</label>
                        <input type="number" id="bet-amount-1" class="form-control" step="0.01" min="0" value="0.00" required>
                    </div>
                    <div class="form-group">
                        <label for="bet-amount-2">Valor Apostado em Lutador 2 *</label>
                        <input type="number" id="bet-amount-2" class="form-control" step="0.01" min="0" value="0.00" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="total-bet">Valor Total Apostado</label>
                        <input type="text" id="total-bet" class="form-control calculated-field" readonly>
                    </div>
                    <div class="form-group">
                        <label for="margin">Margem da Casa</label>
                        <input type="number" id="margin" class="form-control" step="0.01" min="0" max="50" value="0" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="odds-1">Odd Lutador 1</label>
                        <input type="text" id="odds-1" class="form-control calculated-field" readonly>
                    </div>
                    <div class="form-group">
                        <label for="odds-2">Odd Lutador 2</label>
                        <input type="text" id="odds-2" class="form-control calculated-field" readonly>
                    </div>
                </div>
                
                <!-- Campo para status -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="status">Status da Luta *</label>
                        <select id="status" class="form-control" required>
                            <option value="scheduled">Agendada</option>
                            <option value="completed">Finalizada</option>
                            <option value="cancelled">Cancelada</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" id="cancel-fight-btn">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Agendar Luta
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/supabase.js"></script>
    <script src="js/admin.js"></script>
    <script>
        // Função para verificar se o Supabase está carregado
        function checkSupabaseReady() {
            if (typeof window.supabase === 'undefined') {
                console.log('Supabase não está carregado. Verificando novamente em 500ms...');
                return false;
            }
            return true;
        }

        // Verificar autenticação ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== INICIANDO CARREGAMENTO DO ADMIN.HTML ===');
            
            // Verificar se o Supabase está carregado
            if (!checkSupabaseReady()) {
                console.error('Supabase não está carregado. Recarregue a página.');
                return;
            }
            
            // Verificar se o usuário está autenticado
            const admin = window.checkAdminAuth();
            console.log('Dados do administrador verificados:', admin);
            
            if (!admin || !admin.isLoggedIn) {
                console.log('Nenhum administrador autenticado. Redirecionando para login...');
                window.location.href = 'login.html';
                return;
            }
            
            console.log('Administrador autenticado com sucesso:', admin);
            
            // Atualizar interface com dados do administrador
            document.getElementById('admin-name').textContent = admin.username;
            document.getElementById('admin-username').textContent = admin.username;
            
            console.log('Iniciando carregamento dos dados do dashboard...');
            
            // Carregar dados do dashboard
            try {
                const dashboardSection = document.getElementById('dashboard-section');
                dashboardSection.classList.add('active');
                carregarDashboard();
                console.log('Dashboard carregado com sucesso');
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
                const messageEl = document.createElement('div');
                messageEl.className = 'form-message message-error';
                messageEl.innerHTML = `<i class="fas fa-exclamation-circle"></i> Erro ao carregar dados: ${error.message}`;
                document.querySelector('.admin-section.active').prepend(messageEl);
            }
            
            // Configurar evento de logout
            document.getElementById('logout-btn').addEventListener('click', async function() {
                console.log('Logout iniciado pelo usuário');
                try {
                    await window.logoutAdmin();
                    console.log('Logout realizado com sucesso');
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Erro no logout:', error);
                }
            });
            
            console.log('=== PÁGINA ADMIN CARREGADA COM SUCESSO ===');
        });
    </script>
</body>
</html>